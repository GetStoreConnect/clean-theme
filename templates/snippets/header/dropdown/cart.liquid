{%- capture item_count %}
  {%- if current_cart != blank and current_cart.item_count > 0 %}
    <div class="SC-Count sc-ml-tiny" data-cart-nav-count>
      {{ current_cart.item_count }}
    </div>
  {%- endif %}
{%- endcapture %}

<li class="SC-Menu_item dropdown sc-cart" data-cart-menu>
  <a href="{{ current_store.cart_path }}" 
     class="SC-Menu_link sc-hide-up-to-medium" 
     data-nav-trigger="cart">
    <span class="sc-hide-up-to-medium sc-pointer-events-none">
      {{ "header.dropdowns.cart.heading" | t }}
    </span>
    {{ item_count }}
  </a>

  <a href="{{ current_store.cart_path }}" class="SC-Icon SC-Icon-button SC-Icon-large sc-hide-medium-and-up">
    {%- render "shared/icons/cart" %}
    {{ item_count }}
  </a>

  {%- comment %} Dropdown {% endcomment %}
  {% if current_product %}
  {% assign product_name = current_product.name %}
    <div class="SC-Modal SC-Modal-skinny sc-cart_modal sc-ms-auto" data-nav="cart" data-sc-cart>
      <div class="SC-Modal_inner sc-ps sc-pt-base">
        <div class="SC-Modal_body sc-one-to-two-column sc-border-bottom">
          <div class="sc-border-right sc-pe sc-flex-col sc-gap sc-text-center">
            <h3 class="sc-font-light sc-font-medium sc-color-sale">
              <span>{% render 'shared/icons/check', height: "1em", style_class: "sc-mr-tiny" %}</span>
              <span>{{ "Added to cart successfully!" }}</span>
            </h3>
            <img 
              src="{{ current_product.image.medium_url }}" 
              alt="{{ current_product.image.alt_text }}" 
              style="width:120px;"
              class="sc-ms-auto"
              >
            <div class="sc-flex-col sc-gap-tiny">
              {%- for item in current_cart.items %}
                {%- if item.name == product_name %}
                  <span>{{ item.name }}</span>
                  <span class="sc-mb-small">{{ current_product.pricing.price | money, compact: false }}</span>
                  <span class="sc-display-inline-block sc-font-light sc-font-small">{{ "Qty:"}} {{ item.quantity }}</span>
                  <span class="sc-display-inline-block sc-font-light sc-font-small">{{ "Total:" }} {{ item.pricing.checkout_price | money, compact: false }}</span>
                {%- endif %}
              {%- endfor %}
            </div>
          </div>
          <div class="sc-flex-col sc-gap sc-pb sc-text-center sc-pe">
            {%- if current_cart.item_count == 1 %}
              <p style="line-height: 20px;"> There is {{ current_cart.item_count }} item <br> in your cart</p>
            {% else %}
              <p style="line-height: 20px;"> There are {{ current_cart.item_count }} items <br> in your cart</p>
            {%- endif %}
              <p class="sc-font-light">{{ "Cart totals:" }} <span data-currency class="sc-font-medium">{{ current_cart.total | money, compact: false }}</span></p>
            {%- render 'shared/cart/continue_shopping_button', class: "sc-cart_button sc-button-outline sc-ms-auto sc-three-quarters" %}
            {%- render "shared/cart/view_cart_button", class: "sc-cart_button sc-bg-darkest sc-ms-auto sc-three-quarters sc-color-white" %}
          </div>
        </div>
        <div class="SC-Modal_footer sc-pt-base">
          <h3 class="sc-mb">{{ "With this products also buy:" }}</h3>
          <div {% comment %}class="sc-one-to-four-column"{% endcomment%} id="modal-slider">
            <div class="sc-card">
              <a href="#">
                {%- render 'shared/placeholder_image' %}
              </a>
              <div class="sc-text-center sc-mt-small">
                <h4 class="sc-font-light sc-font-base sc-color-black sc-mb-tiny">Product 1</h4>
                <p class="sc-font-light sc-font-base">$ 10.00</p>
              </div>
            </div>
            <div class="sc-card">
              <a href="#">
                {%- render 'shared/placeholder_image' %}
              </a>
              <div class="sc-text-center sc-mt-small">
                <h4 class="sc-font-light sc-font-base sc-color-black sc-mb-tiny">Product 1</h4>
                <p class="sc-font-light sc-font-base">$ 10.00</p>
              </div>
            </div>
            <div class="sc-card">
              <a href="#">
                {%- render 'shared/placeholder_image' %}
              </a>
              <div class="sc-text-center sc-mt-small">
                <h4 class="sc-font-light sc-font-base sc-color-black sc-mb-tiny">Product 1</h4>
                <p class="sc-font-light sc-font-base">
                <span class="sc-font-line-through">$ 15.00</span>
                <span class="sc-color-sale"> $ 10.00</span>
                </p>
              </div>
            </div>
            <div class="sc-card">
              <a href="#">
                {%- render 'shared/placeholder_image' %}
              </a>
              <div class="sc-text-center sc-mt-small">
                <h4 class="sc-font-light sc-font-base sc-color-black sc-mb-tiny">Product 1</h4>
                <p class="sc-font-light sc-font-base">$ 10.00</p>
              </div>
            </div>
            {% comment %}
            {% for related in current_product.related_products %}
              <div class="sc-card">
                <a href={{ related.path }}>
                  <img src="{{ related.image.small_url }}" alt="{{ related.image.alt_text }}">
                  <h4>{{ related.name }}</h4>
                </a>
                To do: add sales price conditional
                <span>{{ related.pricing.price }}</span>
              </div>
              {% endfor %}
            {% endcomment %}
          </div>
        </div>
      </div>
      <div class="SC-Modal_overlay"></div>
    </div>
  {% else %}
    {%- if current_cart != blank and current_cart.items.size > 0 %}
      <div class="sc-cart_dropdown" data-nav="cart" data-sc-cart>
        <div class="sc-cart_header sc-border-bottom">
          <div class="sc-cart_header_section sc-p-small sc-border-right">
            <button data-nav-close="root" type="button">
              {%- render 'shared/icons/close', width: '18', style_class: 'sc-mt-tiny' %}
            </button>
          </div>
          <div class="sc-p-small">
            <h3 class="sc-m-none">{{ "Shopping Cart" }}</h3>
          </div>
          <div class="sc-cart_header_section sc-p-small sc-border-left">
          {{ current_cart.item_count }}
          </div>
        </div>
        
        {%- comment %} Line items {% endcomment %}

        <div class="SC-CartProducts sc-grow sc-overflow-y-auto sc-ps-medium">
          {%- render "shared/cart/items", source: current_cart, compact: true, width: "70px" %}
        </div>
        {%- comment %} Cart total {% endcomment %}
        <div class="sc-cart_total sc-p-medium" data-cart-nav-summary>
          {%- render "shared/order_total", source: current_cart, compact: true %}
        </div>
        {%- comment %} Checkout button {% endcomment %}
        <div class="sc-cart_actions sc-color-white">
          {%- render "shared/cart/view_cart_button", class: "sc-cart_button sc-bg-dark sc-one-half" %}
          {%- render "shared/cart/checkout_button", class: "sc-cart_button sc-bg-darkest sc-one-half" %}
        </div>
      </div>
    {%- endif %}
  {% endif %}
</li>
